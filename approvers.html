<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Web A11y Tracker | Approval Workflow</title>
    <link type="text/css" rel="stylesheet" href="./styles.css" />
    <link
      rel="icon"
      href="./ontario-design-system-dist-1.8.0/favicons/favicon-48x48.png"
      type="image/x-icon"
    />
  </head>

  <div class="documentation-only--application">
    <div class="ontario-header__container">
      <header
        class="ontario-application-header ontario-header"
        id="ontario-header"
      >
        <div class="ontario-row">
          <div
            class="ontario-columns ontario-small-6 ontario-application-header__logo"
          >
            <a href="https://www.ontario.ca/page/government-ontario">
              <img
                src="./ontario-design-system-dist-1.8.0/logos/ontario-logo--desktop.svg"
                alt="Ontario.ca homepage"
                role="img"
              />
            </a>
          </div>
          <div
            class="ontario-columns ontario-small-6 ontario-application-header__lang-toggle"
          >
            <a
              href="#"
              class="ontario-header__language-toggler ontario-header-button ontario-header-button--without-outline"
            >
              Fran√ßais
            </a>
          </div>
        </div>
      </header>
      <div class="ontario-application-subheader-menu__container">
        <section class="ontario-application-subheader">
          <div class="ontario-row">
            <div
              class="ontario-columns ontario-small-12 ontario-application-subheader__container"
            >
              <p class="ontario-application-subheader__heading">
                <a href="#">Web A11y Tracker</a>
              </p>
              <div class="ontario-application-subheader__menu-container">
                <ul
                  class="ontario-application-subheader__menu ontario-show-for-large"
                >
                  <li><a href="#">Link 1</a></li>
                  <li><a href="#">Link 2</a></li>
                </ul>
                <button
                  class="ontario-header__menu-toggler ontario-header-button ontario-header-button--with-outline"
                  id="ontario-header-menu-toggler"
                  aria-controls="ontario-navigation"
                  aria-label="Show navigation menu"
                  type="button"
                >
                  <svg
                    class="ontario-icon"
                    focusable="false"
                    viewBox="0 0 24 24"
                    preserveAspectRatio="xMidYMid meet"
                  >
                    <use
                      xlink:href="./ontario-design-system-dist-1.8.0/icons/ontario-icons-primary.svg#ontario-icon-menu"
                      id="ontario-header-menu-icon"
                    ></use>
                  </svg>
                  <span>Menu</span>
                </button>
              </div>
            </div>
          </div>
        </section>
        <nav class="ontario-navigation" id="ontario-navigation">
          <button
            class="ontario-header__menu-toggler ontario-header-button ontario-header-button--with-outline"
            id="ontario-header-nav-toggler"
            aria-controls="ontario-navigation"
            aria-label="Hide navigation menu"
          >
            <svg
              class="ontario-icon"
              focusable="false"
              viewBox="0 0 24 24"
              preserveAspectRatio="xMidYMid meet"
            >
              <use xlink:href="#ontario-icon-close"></use>
            </svg>
            <span>Menu</span>
          </button>
          <div class="ontario-navigation__container">
            <ul>
              <li class="ontario-show-for-small-only">
                <a href="#">Link 1</a>
              </li>
              <li class="ontario-show-for-small-only">
                <a href="#">Link 2</a>
              </li>
              <li class="ontario-hide-for-large"><a href="#">Link 3</a></li>
              <li class="ontario-hide-for-large"><a href="#">Link 4</a></li>
              <li class="ontario-hide-for-large"><a href="#">Link 5</a></li>
              <li><a href="#">Link 6</a></li>
              <li><a href="#">Link 7</a></li>
              <li><a href="#">Link 8</a></li>
            </ul>
          </div>
        </nav>
      </div>
    </div>
    <div class="ontario-overlay"></div>
  </div>

  <body>
    <h1 class="workflow-title">Approval Workflow</h1>

    <div id="app">
      <ul
        class="ontario-card__container ontario-card--cards-per-row-1 approver-info"
        id="approvers"
      ></ul>

      <button
        class="ontario-button ontario-button--primary approver"
        id="addApproverBtn"
      >
        Add Additional Approver
      </button>

      <div class="ontario-form-group approver-form">
        <label class="ontario-label approver-name">
          Name
          <span class="ontario-label__flag">(required)</span>
        </label>
        <input class="ontario-input approver" type="text" id="nameInput" />

        <label class="ontario-label email">
          Email
          <span class="ontario-label__flag">(required)</span>
        </label>
        <input class="ontario-input approver" type="text" id="emailInput" />

        <label class="ontario-label">
          Role
          <span class="ontario-label__flag">(required)</span>
        </label>
        <input class="ontario-input approver" type="text" id="roleInput" />

        <div class="ontario-form-group apprev">
          <label class="ontario-label" for="apprev">
            Approver/Reviewer<span class="ontario-label__flag">
              (required)</span
            >
          </label>
          <select
            required
            class="ontario-input ontario-dropdown approver"
            id="apprevInput"
          >
            <option value="" disabled selected>Choose one</option>
            <option value="Approver">Approver</option>
            <option value="Reviewer">Reviewer</option>
          </select>
        </div>

        <label class="ontario-label">
          Delegate
          <span class="ontario-label__flag">(optional)</span>
        </label>
        <input
          class="ontario-input delegateInput"
          type="text"
          id="delegateInput"
        />

        <div>
          <button
            class="ontario-button ontario-button--primary save-approver"
            id="saveApproverBtn"
          >
            Save
          </button>
          <button
            class="ontario-button ontario-button--secondary cancel-approver"
            id="cancelApproverBtn"
          >
            Cancel
          </button>
        </div>
      </div>
    </div>

    <footer class="ontario-footer ontario-footer--default">
      <div class="ontario-row">
        <div class="ontario-columns ontario-small-12">
          <ul
            class="ontario-footer__links-container ontario-footer__links-container--inline"
          >
            <li>
              <a
                class="ontario-footer__link"
                href="https://www.ontario.ca/page/accessibility"
                >Accessibility</a
              >
            </li>
            <li>
              <a
                class="ontario-footer__link"
                href="https://www.ontario.ca/page/privacy-statement"
                >Privacy</a
              >
            </li>
            <li><a class="ontario-footer__link" href="#">Contact us</a></li>
          </ul>
          <div class="ontario-footer__copyright">
            <a
              class="ontario-footer__link"
              href="https://www.ontario.ca/page/copyright-information"
              >&copy; King's Printer for Ontario,
              <span class="ontario-nbsp">2012&ndash;24</span></a
            >
          </div>
        </div>
      </div>
    </footer>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const approversDiv = document.getElementById("approvers");
        const addApproverBtn = document.getElementById("addApproverBtn");
        const saveApproverBtn = document.getElementById("saveApproverBtn");
        const cancelApproverBtn = document.getElementById("cancelApproverBtn");
        const approverForm = document.querySelector(".approver-form");

        const initialApprovers = [
          {
            name: "Business Director Name",
            email: "business.director@ontario.ca",
            role: "Business Director",
            apprev: "Approver",
            delegate: "None",
          },
          {
            name: "Director Name",
            email: "director@ontario.ca",
            role: "Director",
            apprev: "Approver",
            delegate: "None",
          },
          {
            name: "Business Director Name",
            email: "business.director@ontario.ca",
            role: "Business Director",
            apprev: "Approver",
            delegate: "None",
          },
          {
            name: "Work Chair Name",
            email: "work.chair@ontario.ca",
            role: "Work Chair",
            apprev: "Approver",
            delegate: "None",
          },
        ];

        initialApprovers.forEach((approver, index) => {
          addApproverCard(
            approver.name,
            approver.email,
            approver.role,
            approver.apprev,
            approver.delegate,
            false,
            index + 1
          );
        });

        addApproverBtn.addEventListener("click", function () {
          approverForm.style.display = "block";
        });

        cancelApproverBtn.addEventListener("click", function () {
          resetForm();
          approverForm.style.display = "none";
        });

        saveApproverBtn.addEventListener("click", function () {
          const name = document.getElementById("nameInput").value || "None";
          const email = document.getElementById("emailInput").value || "None";
          const role = document.getElementById("roleInput").value || "None";
          const apprev = document.getElementById("apprevInput").value || "None";
          const delegate =
            document.getElementById("delegateInput").value || "None";

          addApproverCard(name, email, role, apprev, delegate, true);

          resetForm();
          approverForm.style.display = "none";
          updateIndicators();
        });

        function resetForm() {
          document.getElementById("nameInput").value = "";
          document.getElementById("emailInput").value = "";
          document.getElementById("roleInput").value = "";
          document.getElementById("apprevInput").value = "";
          document.getElementById("delegateInput").value = "";
        }

        function addApproverCard(
          name,
          email,
          role,
          apprev,
          delegate,
          isDynamic,
          index
        ) {
          const card = document.createElement("li");
          card.className =
            "ontario-card ontario-card--default ontario-card--position-vertical approver-info";
          card.innerHTML = `
              <div class="ontario-card__text-container">
                <div class="card-splitter">
                  <h2 class="ontario-card__heading approver-name">${
                    isDynamic ? "" : `Approver ${index}`
                  }</h2>
                  <div class="ontario-card__description details">
                    <p class="details">
                      <b>Name:</b> ${name} <br> 
                      <b>Email:</b> ${email} <br> 
                      <b>Role:</b> ${role} <br>
                      <b>Approver/Reviewer:</b> ${apprev}<br>
                      <b>Delegate:</b> ${delegate}
                    </p>
                  </div>
                  <div class="card_buttons">
                    <button class="ontario-button ontario-button--secondary delegateBtn">Edit Delegate</button>
                    ${
                      isDynamic
                        ? `
                    <button class="ontario-button ontario-button--secondary moveUpBtn">Move Up</button>
                    <button class="ontario-button ontario-button--secondary moveDownBtn">Move Down</button>
                    <button class="ontario-button ontario-button--secondary removeBtn">Remove</button>`
                        : ""
                    }
                  </div>
                </div>
              </div>
            `;

          const delegateButton = card.querySelector(".delegateBtn");
          const cardButtons = card.querySelector(".card_buttons").children;

          delegateButton.addEventListener("click", function () {
            for (let i = 0; i < cardButtons.length; i++) {
              if (cardButtons[i] !== delegateButton) {
                cardButtons[i].style.display = "none";
              }
            }

            const delegateInput = document.createElement("input");
            delegateInput.className = "ontario-input delegate";
            delegateInput.setAttribute("type", "text");
            delegateInput.setAttribute("placeholder", "Enter delegate's name");
            card.querySelector(".card_buttons").appendChild(delegateInput);

            const saveBtn = document.createElement("button");
            saveBtn.className =
              "ontario-button ontario-button--primary save-delegate";
            saveBtn.textContent = "Save";
            card.querySelector(".card_buttons").appendChild(saveBtn);

            const cancelBtn = document.createElement("button");
            cancelBtn.className =
              "ontario-button ontario-button--secondary cancel-delegate";
            cancelBtn.textContent = "Cancel";
            card.querySelector(".card_buttons").appendChild(cancelBtn);

            const clearBtn = document.createElement("button");
            clearBtn.className =
              "ontario-button ontario-button--secondary clear-delegate";
            clearBtn.textContent = "Clear";
            card.querySelector(".card_buttons").appendChild(clearBtn);

            delegateButton.style.display = "none";

            saveBtn.addEventListener("click", function () {
              const newDelegateName = delegateInput.value || "None";
              const detailsParagraph = card.querySelector(".details p.details");
              const currentDetails = detailsParagraph.innerHTML;
              const newDetails = currentDetails.replace(
                new RegExp("Delegate:</b>.*"),
                `Delegate:</b> ${newDelegateName}`
              );
              detailsParagraph.innerHTML = newDetails;

              card.querySelector(".card_buttons").removeChild(delegateInput);
              card.querySelector(".card_buttons").removeChild(saveBtn);
              card.querySelector(".card_buttons").removeChild(cancelBtn);
              card.querySelector(".card_buttons").removeChild(clearBtn);

              for (let i = 0; i < cardButtons.length; i++) {
                if (cardButtons[i] !== delegateButton) {
                  cardButtons[i].style.display = "block";
                }
              }

              delegateButton.style.display = "block";
              updateIndicators();
            });

            cancelBtn.addEventListener("click", function () {
              card.querySelector(".card_buttons").removeChild(delegateInput);
              card.querySelector(".card_buttons").removeChild(saveBtn);
              card.querySelector(".card_buttons").removeChild(cancelBtn);
              card.querySelector(".card_buttons").removeChild(clearBtn);

              for (let i = 0; i < cardButtons.length; i++) {
                if (cardButtons[i] !== delegateButton) {
                  cardButtons[i].style.display = "block";
                }
              }

              delegateButton.style.display = "block";

              const cards = approversDiv.children;
              const isSecondLastCard = cards[cards.length - 2] === card;
              if (isSecondLastCard) {
                const moveDownBtn = card.querySelector(".moveDownBtn");
                if (moveDownBtn) {
                  moveDownBtn.style.display = "none";
                }
              }
            });

            clearBtn.addEventListener("click", function () {
              const detailsParagraph = card.querySelector(".details p.details");
              const currentDetails = detailsParagraph.innerHTML;
              const newDetails = currentDetails.replace(
                new RegExp("Delegate:</b>.*"),
                `Delegate:</b> None`
              );
              detailsParagraph.innerHTML = newDetails;

              card.querySelector(".card_buttons").removeChild(delegateInput);
              card.querySelector(".card_buttons").removeChild(saveBtn);
              card.querySelector(".card_buttons").removeChild(cancelBtn);
              card.querySelector(".card_buttons").removeChild(clearBtn);

              for (let i = 0; i < cardButtons.length; i++) {
                if (cardButtons[i] !== delegateButton) {
                  cardButtons[i].style.display = "block";
                }
              }

              delegateButton.style.display = "block";
              updateIndicators();
            });
          });

          if (isDynamic) {
            const removeBtn = card.querySelector(".removeBtn");
            const moveUpBtn = card.querySelector(".moveUpBtn");
            const moveDownBtn = card.querySelector(".moveDownBtn");
            removeBtn.addEventListener("click", function () {
              removeApprover(card);
              updateIndicators();
            });
            moveUpBtn.addEventListener("click", function () {
              moveUp(card);
              updateIndicators();
            });
            moveDownBtn.addEventListener("click", function () {
              moveDown(card);
              updateIndicators();
            });
          }

          if (approversDiv.children.length === 0) {
            approversDiv.appendChild(card);
          } else {
            const secondLastCard =
              approversDiv.children[approversDiv.children.length - 1];
            approversDiv.insertBefore(card, secondLastCard);
          }

          updateIndicators();
        }

        function removeApprover(card) {
          approversDiv.removeChild(card);
          updateIndicators();
        }

        function moveUp(card) {
          const prevCard = card.previousElementSibling;
          if (prevCard) {
            approversDiv.insertBefore(card, prevCard);
            updateIndicators();
          }
        }

        function moveDown(card) {
          const nextCard = card.nextElementSibling;
          if (nextCard) {
            approversDiv.insertBefore(nextCard, card);
            updateIndicators();
          }
        }

        function updateIndicators() {
          const cards = approversDiv.children;
          for (let i = 0; i < cards.length; i++) {
            const heading = cards[i].querySelector(".ontario-card__heading");
            heading.textContent = `Approver ${i + 1}`;

            const moveDownBtn = cards[i].querySelector(".moveDownBtn");
            if (moveDownBtn) {
              if (i === cards.length - 2) {
                moveDownBtn.style.display = "none";
              } else {
                moveDownBtn.style.display = "block";
              }
            }
          }
        }
      });
    </script>
  </body>
</html>
